create table Produtos_Vendidos (
Id int auto_increment,
Produto varchar(100) not null,
Quantidade_Vendidos int not null default 0,
Mes tinyint not null,
Ano_Retirado smallint not null,
check(Mes >= 1 and Mes <= 12),
check(Ano_Retirado between 2000 and 2060),
check(Quantidade_Vendidos >= 0),
unique(Produto, Ano_Retirado, Mes),
primary key(Id)
);

DELIMITER $$
create trigger Vendas_Produtos after insert
on produtos_vendidos
FOR EACH ROW
BEGIN
	update produtos_vendidos set new.Id, new.Produtos, new.Preço, Quantidade_Vendidos = Quantidade_Estoque - new.Mes, new.Ano_Retirado, new.Horario
WHERE Produto = NEW.Produtos;
end if;
end$

DELIMITER ;

alter table produtos_vendidos add column Horario time;
alter table produtos_vendidos add column Preço double not null after Produto;

insert into produtos_vendidos set Id = '1', produto = 'Smart TV LED 75 4K UHD samsung', Preço = '5890.00', Quantidade_Vendidos = '101', Mes = '12', Ano_Retirado = '2022', Horario ='16:57:00';
insert into produtos_vendidos (Id, produto, Preço, Quantidade_Vendidos, Mes, Ano_Retirado, Horario) values ('2', 'Maleta de ferramentas kit com 129', '81.99', '50', '10', '2022', '17:08:00');
insert into produtos_vendidos (Id, produto, Preço, Quantidade_Vendidos, Mes, Ano_Retirado, Horario) values ('3', 'Samsung Galaxy A22 Branco 128 GB', '1100.00', '100', '05', '2022', '17:15:20');

select * from produtos_vendidos;
